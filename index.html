import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signInWithEmailAndPassword, signOut } from 'firebase/auth';
import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp } from 'firebase/firestore';
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';

// Ensure Tailwind CSS is available in the environment.
// For icons, we'll use Lucide React icons or simple inline SVGs.
import { Home as HomeIcon, Info, Briefcase, TrendingUp, Mail, LogIn, UploadCloud, CheckCircle, XCircle, Clock } from 'lucide-react';

// Global variables provided by the Canvas environment
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-al-dahmen-app';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

function App() {
  const [db, setDb] = useState(null);
  const [auth, setAuth] = useState(null);
  const [storage, setStorage] = useState(null);
  const [userId, setUserId] = useState(null);
  const [userDisplayName, setUserDisplayName] = useState(''); // To show username in Admin
  const [currentPage, setCurrentPage] = useState('home');
  const [loadingFirebase, setLoadingFirebase] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [modalMessage, setModalMessage] = useState('');
  const [isErrorModal, setIsErrorModal] = useState(false);

  // Initialize Firebase and set up authentication listener
  useEffect(() => {
    const initializeFirebase = async () => {
      try {
        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);
        const firebaseAuth = getAuth(app);
        const firebaseStorage = getStorage(app);

        setDb(firestore);
        setAuth(firebaseAuth);
        setStorage(firebaseStorage);

        // Sign in using custom token if available, otherwise anonymously
        if (initialAuthToken) {
          await signInWithCustomToken(firebaseAuth, initialAuthToken);
        } else {
          await signInAnonymously(firebaseAuth);
        }

        // Set up auth state change listener
        onAuthStateChanged(firebaseAuth, (user) => {
          if (user) {
            setUserId(user.uid);
            setUserDisplayName(user.email || user.uid); // Use email if available, else uid
            console.log('Firebase user logged in:', user.uid);
          } else {
            setUserId(null);
            setUserDisplayName('');
            console.log('Firebase user logged out or anonymous.');
          }
          setLoadingFirebase(false);
        });
      } catch (error) {
        console.error("Error initializing Firebase:", error);
        setModalMessage(`Failed to initialize Firebase: ${error.message}`);
        setIsErrorModal(true);
        setShowModal(true);
        setLoadingFirebase(false);
      }
    };

    initializeFirebase();
  }, []);

  // Function to show custom modal
  const showCustomModal = (message, isError = false) => {
    setModalMessage(message);
    setIsErrorModal(isError);
    setShowModal(true);
  };

  if (loadingFirebase) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-100 font-inter">
        <div className="flex items-center space-x-2">
          <div className="w-4 h-4 rounded-full animate-pulse bg-blue-500"></div>
          <div className="w-4 h-4 rounded-full animate-pulse bg-blue-500"></div>
          <div className="w-4 h-4 rounded-full animate-pulse bg-blue-500"></div>
          <span className="text-gray-700">Loading website...</span>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 text-gray-800 font-inter flex flex-col">
      {/* Custom Modal */}
      {showModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className={`bg-white rounded-lg shadow-xl p-6 md:p-8 max-w-md w-full transition-all duration-300 transform scale-95 opacity-0 ${showModal ? 'scale-100 opacity-100' : ''}`}>
            <h3 className={`text-xl font-bold mb-4 ${isErrorModal ? 'text-red-600' : 'text-green-600'}`}>
              {isErrorModal ? 'Error!' : 'Success!'}
            </h3>
            <p className="text-gray-700 mb-6">{modalMessage}</p>
            <button
              onClick={() => setShowModal(false)}
              className={`w-full py-3 rounded-lg text-white font-semibold transition-all duration-200 ${isErrorModal ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'}`}
            >
              Close
            </button>
          </div>
        </div>
      )}

      {/* Navbar */}
      <nav className="bg-gradient-to-r from-blue-700 to-indigo-800 shadow-lg p-4 sticky top-0 z-40">
        <div className="container mx-auto flex flex-wrap items-center justify-between">
          <a href="#" onClick={() => setCurrentPage('home')} className="text-white text-2xl font-bold flex items-center gap-2 rounded-lg p-2 transition-all duration-200 hover:bg-blue-600">
            <span className="text-3xl">üèõÔ∏è</span> Al-Dahmen for Exchange
          </a>
          <div className="block lg:hidden">
            <button
              onClick={() => document.getElementById('navbar-links').classList.toggle('hidden')}
              className="text-white focus:outline-none focus:ring-2 focus:ring-white rounded-md p-2"
            >
              <svg className="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>
          <div id="navbar-links" className="hidden lg:flex lg:items-center lg:w-auto w-full mt-4 lg:mt-0">
            <ul className="lg:flex items-center justify-between text-base text-white pt-4 lg:pt-0">
              <li>
                <a href="#" onClick={() => setCurrentPage('home')} className="flex items-center gap-2 lg:p-4 py-2 block hover:text-gray-200 transition-colors duration-200 rounded-lg lg:hover:bg-blue-600 px-4">
                  <HomeIcon size={18} /> Home
                </a>
              </li>
              <li>
                <a href="#" onClick={() => setCurrentPage('about')} className="flex items-center gap-2 lg:p-4 py-2 block hover:text-gray-200 transition-colors duration-200 rounded-lg lg:hover:bg-blue-600 px-4">
                  <Info size={18} /> About Us
                </a>
              </li>
              <li>
                <a href="#" onClick={() => setCurrentPage('services')} className="flex items-center gap-2 lg:p-4 py-2 block hover:text-gray-200 transition-colors duration-200 rounded-lg lg:hover:bg-blue-600 px-4">
                  <Briefcase size={18} /> Our Services
                </a>
              </li>
              <li>
                <a href="#" onClick={() => setCurrentPage('tech')} className="flex items-center gap-2 lg:p-4 py-2 block hover:text-gray-200 transition-colors duration-200 rounded-lg lg:hover:bg-blue-600 px-4">
                  <TrendingUp size={18} /> Tech & Innovation
                </a>
              </li>
              <li>
                <a href="#" onClick={() => setCurrentPage('contact')} className="flex items-center gap-2 lg:p-4 py-2 block hover:text-gray-200 transition-colors duration-200 rounded-lg lg:hover:bg-blue-600 px-4">
                  <Mail size={18} /> Contact
                </a>
              </li>
              <li className="lg:ml-4">
                {auth?.currentUser?.email ? (
                  <button
                    onClick={() => {
                      signOut(auth);
                      showCustomModal('Logged out successfully!', false);
                      setCurrentPage('home'); // Redirect to home after logout
                    }}
                    className="flex items-center gap-2 lg:px-6 lg:py-3 py-2 block bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200 px-4"
                  >
                    <LogIn size={18} /> Logout ({userDisplayName.split('@')[0]})
                  </button>
                ) : (
                  <a href="#" onClick={() => setCurrentPage('admin-login')} className="flex items-center gap-2 lg:px-6 lg:py-3 py-2 block bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-semibold rounded-lg shadow-md transition-all duration-200 px-4">
                    <LogIn size={18} /> Admin Login
                  </a>
                )}
              </li>
            </ul>
          </div>
        </div>
      </nav>

      {/* Main Content Area */}
      <main className="flex-grow">
        {currentPage === 'home' && <HomePage setCurrentPage={setCurrentPage} />}
        {currentPage === 'about' && <AboutUsPage />}
        {currentPage === 'services' && <ServicesPage db={db} storage={storage} userId={userId} showCustomModal={showCustomModal} />}
        {currentPage === 'tech' && <TechInnovationPage />}
        {currentPage === 'contact' && <ContactPage db={db} userId={userId} showCustomModal={showCustomModal} />}
        {currentPage === 'admin-login' && <AdminLoginPage auth={auth} db={db} userId={userId} showCustomModal={showCustomModal} setCurrentPage={setCurrentPage} userDisplayName={userDisplayName} />}
        {currentPage === 'admin-dashboard' && auth?.currentUser?.email && <AdminDashboard db={db} userId={userId} showCustomModal={showCustomModal} userDisplayName={userDisplayName} />}
      </main>

      {/* Footer */}
      <footer className="bg-gray-800 text-white p-6 mt-12">
        <div className="container mx-auto text-center md:flex md:justify-between md:items-center">
          <p className="mb-4 md:mb-0">&copy; {new Date().getFullYear()} Al-Dahmen for Exchange. All rights reserved.</p>
          <div className="flex justify-center space-x-6">
            <a href="#" className="hover:text-blue-400 transition-colors duration-200 text-sm">Privacy Policy</a>
            <a href="#" className="hover:text-blue-400 transition-colors duration-200 text-sm">Terms of Service</a>
          </div>
        </div>
      </footer>
    </div>
  );
}

// --- Page Components ---

const HomePage = ({ setCurrentPage }) => (
  <section className="bg-gradient-to-br from-blue-600 to-indigo-700 text-white py-20 md:py-32 relative overflow-hidden rounded-b-lg shadow-xl">
    <div className="absolute inset-0 bg-pattern opacity-10"></div> {/* Decorative pattern */}
    <div className="container mx-auto text-center relative z-10 px-4">
      <h1 className="text-4xl md:text-6xl font-extrabold leading-tight mb-6 animate-fade-in-down">
        Fast. Reliable. <span className="block mt-2">Digital-first Currency Exchange</span>
      </h1>
      <p className="text-xl md:text-2xl mb-10 max-w-3xl mx-auto animate-fade-in-up">
        Your trusted partner for secure and efficient financial services in Karbala and beyond.
      </p>
      <div className="flex flex-col sm:flex-row justify-center gap-4 animate-fade-in">
        <button
          onClick={() => setCurrentPage('services')}
          className="bg-white text-blue-700 px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:bg-gray-200 transition-all duration-300 transform hover:scale-105"
        >
          Exchange Now
        </button>
        <button
          onClick={() => setCurrentPage('services')}
          className="bg-transparent border-2 border-white text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:bg-white hover:text-blue-700 transition-all duration-300 transform hover:scale-105"
        >
          Book Travel Dollars
        </button>
        <button
          onClick={() => setCurrentPage('admin-login')}
          className="bg-yellow-400 text-gray-900 px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:bg-yellow-500 transition-all duration-300 transform hover:scale-105"
        >
          Login to Partner Dashboard
        </button>
      </div>
    </div>

    {/* Trust Indicators Section */}
    <div className="bg-white bg-opacity-90 rounded-xl shadow-lg mt-20 p-8 max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 text-gray-800 animate-fade-in-up-delay px-4">
      <div className="text-center">
        <span className="block text-4xl font-bold text-blue-700 mb-2">‚úÖ</span>
        <h3 className="text-xl font-semibold mb-2">Fully Licensed</h3>
        <p className="text-gray-600">Operating under strict regulatory compliance.</p>
      </div>
      <div className="text-center">
        <span className="block text-4xl font-bold text-blue-700 mb-2">‚≠ê</span>
        <h3 className="text-xl font-semibold mb-2">10+ Years Experience</h3>
        <p className="text-gray-600">A decade of trusted financial services.</p>
      </div>
      <div className="text-center">
        <span className="block text-4xl font-bold text-blue-700 mb-2">üìç</span>
        <h3 className="text-xl font-semibold mb-2">Karbala Based</h3>
        <p className="text-gray-600">Proudly serving the holy city of Karbala.</p>
      </div>
    </div>
  </section>
);

const AboutUsPage = () => (
  <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in-left px-4">
    <h2 className="text-4xl font-extrabold text-blue-700 mb-8 text-center border-b-4 border-blue-200 pb-4">About Al-Dahmen for Exchange</h2>

    <div className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
      <div>
        <h3 className="text-3xl font-bold text-gray-800 mb-4">Our Story & Mission</h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-6">
          Established over a decade ago in the heart of Karbala, Al-Dahmen for Exchange has grown into a cornerstone of financial stability and trust. Our mission is to provide seamless, secure, and transparent currency exchange and remittance services that meet the diverse needs of individuals, businesses, and international travelers. We are committed to fostering financial inclusion and empowering our community through reliable financial solutions.
        </p>
        <p className="text-lg text-gray-700 leading-relaxed">
          We combine traditional values of integrity and customer-centric service with cutting-edge technology, ensuring every transaction is handled with the utmost efficiency and security.
        </p>
      </div>
      <div className="relative w-full h-64 md:h-80 bg-gradient-to-br from-blue-300 to-indigo-400 rounded-xl shadow-inner overflow-hidden flex items-center justify-center p-4">
        {/* Placeholder image for a team photo or general financial image */}
        <span className="text-white text-6xl opacity-70">
          <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-users">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
        </span>
        <div className="absolute bottom-4 right-4 text-white text-sm opacity-80">Our Dedicated Team</div>
      </div>
    </div>

    <div className="mt-12">
      <h3 className="text-3xl font-bold text-gray-800 mb-4 text-center">Regulatory Compliance & Licensing</h3>
      <div className="bg-blue-50 p-6 rounded-xl shadow-inner text-gray-700 leading-relaxed">
        <p className="mb-4">
          Al-Dahmen for Exchange operates under the strict supervision and licensing of the <span className="font-semibold text-blue-700">Central Bank of Iraq</span>. We adhere to all national and international anti-money laundering (AML) and counter-terrorism financing (CTF) regulations. Our commitment to compliance ensures the highest standards of security and integrity in all our operations.
        </p>
        <p className="font-medium">
          License No: <span className="text-blue-700">CBI-XXXX-YYYY</span> (Example) <br />
          Issued by: <span className="text-blue-700">Central Bank of Iraq</span>
        </p>
      </div>
    </div>

    <div className="mt-12 text-center">
      <h3 className="text-3xl font-bold text-gray-800 mb-4">Our Branch</h3>
      <p className="text-lg text-gray-700 mb-6">
        Visit us at our convenient location in Karbala for in-person service.
      </p>
      <div className="bg-blue-50 p-6 rounded-xl shadow-inner max-w-2xl mx-auto">
        <p className="text-xl font-semibold text-blue-700 mb-2">Main Branch: Karbala Al-Muqaddasa</p>
        <p className="text-md text-gray-700 mb-4">
          Street Name, Building Number, Karbala, Iraq
        </p>
        {/* Placeholder for Google Maps iframe - In a real deployment, you'd embed the actual map here */}
        <div className="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500 text-sm italic overflow-hidden">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d13778.653457002078!2d44.02077595!3d32.61715425!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMsrcMDgnNDQuMyJOIDQ0wrAxJzQyLjEiRQ!5e0!3m2!1sen!2siq!4v1678912345678!5m2!1sen!2siq"
            width="100%"
            height="100%"
            style={{ border: 0 }}
            allowFullScreen=""
            loading="lazy"
            referrerPolicy="no-referrer-when-downgrade"
            title="Al-Dahmen for Exchange Location"
            className="rounded-lg"
          ></iframe>
        </div>
      </div>
    </div>
  </section>
);

const ServicesPage = ({ db, storage, userId, showCustomModal }) => {
  const [passportFile, setPassportFile] = useState(null);
  const [ticketFile, setTicketFile] = useState(null);
  const [formInput, setFormInput] = useState({
    name: '',
    email: '',
    phone: '',
    passportNumber: '',
    ticketNumber: '',
    amount: '',
  });
  const [loading, setLoading] = useState(false);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormInput((prev) => ({ ...prev, [name]: value }));
  };

  const handleFileChange = (e, fileType) => {
    if (fileType === 'passport') {
      setPassportFile(e.target.files[0]);
    } else {
      setTicketFile(e.target.files[0]);
    }
  };

  const uploadFile = async (file, folderName) => {
    if (!file || !storage) return null;

    const fileRef = ref(storage, `artifacts/${appId}/public/data/travelDollarBookings/${userId}/${folderName}/${file.name}`);
    const uploadTask = uploadBytesResumable(fileRef, file);

    return new Promise((resolve, reject) => {
      uploadTask.on(
        'state_changed',
        (snapshot) => {
          // Progress can be shown here if needed
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          console.log(`Upload of ${file.name} is ${progress}% done`);
        },
        (error) => {
          console.error("File upload error:", error);
          reject(error);
        },
        async () => {
          try {
            const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
            resolve(downloadURL);
          } catch (error) {
            console.error("Error getting download URL:", error);
            reject(error);
          }
        }
      );
    });
  };

  const handleSubmitBooking = async (e) => {
    e.preventDefault();
    setLoading(true);

    if (!db || !userId) {
      showCustomModal('Firebase not initialized or user not authenticated. Please try again.', true);
      setLoading(false);
      return;
    }

    // Basic validation
    if (!formInput.name || !formInput.email || !formInput.phone || !formInput.amount || !passportFile || !ticketFile) {
      showCustomModal('Please fill in all required fields and upload both passport and ticket files.', true);
      setLoading(false);
      return;
    }

    try {
      const passportUrl = await uploadFile(passportFile, 'passports');
      const ticketUrl = await uploadFile(ticketFile, 'tickets');

      if (!passportUrl || !ticketUrl) {
        throw new Error("Failed to upload one or more files.");
      }

      const bookingData = {
        ...formInput,
        passportFileUrl: passportUrl,
        ticketFileUrl: ticketUrl,
        status: 'Pending', // Initial status for admin review
        timestamp: serverTimestamp(),
        // Store in public collection as per security rules: /artifacts/{appId}/public/data/{your_collection_name}
        // Add userId to allow authenticated users to read/write their own bookings if needed, but this is a public form
        submittedByUserId: userId,
      };

      const docRef = await addDoc(collection(db, `artifacts/${appId}/public/data/travelDollarBookings`), bookingData);
      console.log("Document written with ID: ", docRef.id);

      showCustomModal('Your travel dollar booking has been submitted successfully! We will contact you shortly.', false);

      // Reset form
      setFormInput({
        name: '',
        email: '',
        phone: '',
        passportNumber: '',
        ticketNumber: '',
        amount: '',
      });
      setPassportFile(null);
      setTicketFile(null);
      // Clear file input values manually as direct state reset doesn't work for file inputs
      e.target.elements.passportFile.value = '';
      e.target.elements.ticketFile.value = '';

    } catch (error) {
      console.error("Error submitting booking:", error);
      showCustomModal(`Failed to submit booking: ${error.message}`, true);
    } finally {
      setLoading(false);
    }
  };

  return (
    <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in-right px-4">
      <h2 className="text-4xl font-extrabold text-blue-700 mb-8 text-center border-b-4 border-blue-200 pb-4">Our Services</h2>

      {/* Currency Exchange */}
      <div className="mb-12 bg-blue-50 p-6 rounded-xl shadow-inner">
        <h3 className="text-3xl font-bold text-gray-800 mb-4 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-indian-rupee">
            <path d="M6 3h12" />
            <path d="M6 8h12" />
            <path d="m6 13 8.5 8" />
            <path d="M14 13h-8" />
            <path d="M14 13c1.8 0 3-.9 3-2.5s-2.2-2.5-4-2.5h-2" />
          </svg>
          Currency Exchange
        </h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-4">
          We offer highly competitive rates for a wide range of major currencies. Our transparent pricing ensures you get the best value without any hidden fees.
        </p>
        <ul className="list-disc list-inside text-gray-700 text-lg grid grid-cols-1 sm:grid-cols-2 gap-2">
          <li>USD (United States Dollar)</li>
          <li>EUR (Euro)</li>
          <li>GBP (British Pound)</li>
          <li>TRY (Turkish Lira)</li>
          <li>SAR (Saudi Riyal)</li>
          <li>AED (UAE Dirham)</li>
          {/* Add more currencies as needed */}
          <li>And many more!</li>
        </ul>
        <p className="mt-4 text-md text-blue-600 font-semibold">For the latest rates, please visit our branch or contact us directly.</p>
      </div>

      {/* Card Loading & Remittance */}
      <div className="mb-12 bg-green-50 p-6 rounded-xl shadow-inner">
        <h3 className="text-3xl font-bold text-gray-800 mb-4 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-credit-card">
            <rect width="20" height="14" x="2" y="5" rx="2" />
            <line x1="2" x2="22" y1="10" y2="10" />
          </svg>
          Card Loading & Remittance
        </h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-4">
          Send and receive money globally with ease. We facilitate secure and rapid international transfers through leading remittance networks.
        </p>
        <ul className="list-disc list-inside text-gray-700 text-lg grid grid-cols-1 sm:grid-cols-2 gap-2">
          <li>Western Union Services</li>
          <li>MoneyGram Services</li>
          <li>Secure International Bank Transfers</li>
          <li>Prepaid Card Loading</li>
        </ul>
        <p className="mt-4 text-md text-green-600 font-semibold">Fast, reliable, and accessible for all your global money transfer needs.</p>
      </div>

      {/* Travel Dollar Booking System */}
      <div className="mb-12 bg-yellow-50 p-6 rounded-xl shadow-inner">
        <h3 className="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-plane">
            <path d="M17.8 19.2 16 11l3.5-3.5C21 6 22 5 22 3s-1-2-3.5-.5L11 6 3.2 4.2c-2.1-.5-4.5 1.5-4 3.6l.8 2.3 2.3.8c2.1.5 4.1-1.9 3.6-4L6 11l-8 5.5v2l2-.5L12 18l5.5 8h2l-.5-2" />
          </svg>
          Travel Dollar Booking System (Online)
        </h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-6">
          Effortlessly book your travel dollars online. Our system allows you to schedule appointments and securely upload necessary documents for a seamless process.
        </p>
        <form onSubmit={handleSubmitBooking} className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label htmlFor="name" className="block text-gray-700 text-sm font-bold mb-2">Full Name:</label>
            <input
              type="text"
              id="name"
              name="name"
              value={formInput.name}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="Your Full Name"
              required
            />
          </div>
          <div>
            <label htmlFor="email" className="block text-gray-700 text-sm font-bold mb-2">Email Address:</label>
            <input
              type="email"
              id="email"
              name="email"
              value={formInput.email}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="your@example.com"
              required
            />
          </div>
          <div>
            <label htmlFor="phone" className="block text-gray-700 text-sm font-bold mb-2">Phone Number:</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              value={formInput.phone}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="+964 7XX XXX XXXX"
              required
            />
          </div>
          <div>
            <label htmlFor="passportNumber" className="block text-gray-700 text-sm font-bold mb-2">Passport Number:</label>
            <input
              type="text"
              id="passportNumber"
              name="passportNumber"
              value={formInput.passportNumber}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="ABC123456"
              required
            />
          </div>
          <div>
            <label htmlFor="ticketNumber" className="block text-gray-700 text-sm font-bold mb-2">Ticket Number:</label>
            <input
              type="text"
              id="ticketNumber"
              name="ticketNumber"
              value={formInput.ticketNumber}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="Airline Ticket Number"
              required
            />
          </div>
          <div>
            <label htmlFor="amount" className="block text-gray-700 text-sm font-bold mb-2">Desired Amount (USD):</label>
            <input
              type="number"
              id="amount"
              name="amount"
              value={formInput.amount}
              onChange={handleInputChange}
              className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
              placeholder="e.g., 5000"
              min="100"
              required
            />
          </div>
          <div>
            <label htmlFor="passportFile" className="block text-gray-700 text-sm font-bold mb-2">Upload Passport Scan (PDF/JPG/PNG):</label>
            <input
              type="file"
              id="passportFile"
              name="passportFile"
              onChange={(e) => handleFileChange(e, 'passport')}
              accept=".pdf,.jpg,.jpeg,.png"
              className="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer rounded-lg border border-gray-300 p-2"
              required
            />
            {passportFile && <p className="text-xs text-gray-500 mt-1">Selected: {passportFile.name}</p>}
          </div>
          <div>
            <label htmlFor="ticketFile" className="block text-gray-700 text-sm font-bold mb-2">Upload Ticket (PDF/JPG/PNG):</label>
            <input
              type="file"
              id="ticketFile"
              name="ticketFile"
              onChange={(e) => handleFileChange(e, 'ticket')}
              accept=".pdf,.jpg,.jpeg,.png"
              className="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer rounded-lg border border-gray-300 p-2"
              required
            />
            {ticketFile && <p className="text-xs text-gray-500 mt-1">Selected: {ticketFile.name}</p>}
          </div>
          <div className="md:col-span-2 text-center">
            <button
              type="submit"
              disabled={loading}
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center mx-auto min-w-[150px]"
            >
              {loading ? (
                <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              ) : (
                <>
                  <UploadCloud size={20} className="mr-2" /> Submit Booking
                </>
              )}
            </button>
          </div>
        </form>
        <p className="mt-6 text-sm text-center text-gray-500">
          <span className="font-semibold text-red-500">Note:</span> After submission, our team will review your documents and contact you for confirmation and appointment details. WhatsApp notifications for auto-confirmation require server-side integration and are not part of this client-side demo.
        </p>
      </div>

      {/* Software Solutions for Exchange Companies */}
      <div className="bg-purple-50 p-6 rounded-xl shadow-inner">
        <h3 className="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-monitor-dot">
            <circle cx="12" cy="12" r="1" />
            <path d="M19 3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h4l2 3h2l2-3h4a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z" />
          </svg>
          Software Solutions for Exchange Companies
        </h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-4">
          Beyond our direct exchange services, we are innovators building the future of financial operations. Our custom-built fintech software suite is designed to revolutionize daily operations for exchange companies across Iraq and the region.
        </p>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Automated Customer Booking</h4>
            <p className="text-gray-600 text-sm">Streamline appointment scheduling for various services.</p>
          </div>
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Travel Dollar Workflow</h4>
            <p className="text-gray-600 text-sm">Manage travel dollar requests from submission to approval.</p>
          </div>
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Secure Document Upload</h4>
            <p className="text-gray-600 text-sm">Safely collect passports, tickets, and other vital documents.</p>
          </div>
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Admin Dashboard</h4>
            <p className="text-gray-600 text-sm">Centralized control panel to approve/reject bookings, manage data.</p>
          </div>
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Notification Integration</h4>
            <p className="text-gray-600 text-sm">Automated WhatsApp/Telegram notifications for customer updates.</p>
          </div>
          <div className="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
            <h4 className="font-semibold text-lg text-blue-700 mb-2">Modern Tech Stack</h4>
            <p className="text-gray-600 text-sm">Built with React (PWA-ready) and Firebase for robustness.</p>
          </div>
        </div>
        <p className="mt-6 text-lg text-purple-700 font-semibold text-center">
          Our software is designed for easy deployment and minimal training, ensuring a smooth digital transformation for your business.
        </p>
      </div>
    </section>
  );
};

const TechInnovationPage = () => (
  <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in-up px-4">
    <h2 className="text-4xl font-extrabold text-blue-700 mb-8 text-center border-b-4 border-blue-200 pb-4">Tech & Innovation at Al-Dahmen</h2>

    <div className="text-center mb-12">
      <p className="text-2xl md:text-3xl font-semibold text-gray-800 leading-relaxed max-w-3xl mx-auto">
        "We are not just an exchange company ‚Äî we are building the future of digital exchange in Iraq."
      </p>
    </div>

    <div className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
      <div>
        <h3 className="text-3xl font-bold text-gray-800 mb-4">Our Vision for Digital Exchange</h3>
        <p className="text-lg text-gray-700 leading-relaxed mb-6">
          At Al-Dahmen, innovation is at our core. We believe that technology is key to enhancing efficiency, security, and customer satisfaction in the financial sector. Our dedicated team of developers has engineered a proprietary software suite that addresses the unique challenges and opportunities within the Iraqi and regional exchange markets.
        </p>
        <p className="text-lg text-gray-700 leading-relaxed">
          This in-house solution automates complex workflows, provides real-time data insights, and ensures seamless compliance, setting new industry standards for operational excellence.
        </p>
      </div>
      <div className="relative w-full h-64 md:h-80 bg-gradient-to-br from-indigo-300 to-purple-400 rounded-xl shadow-inner overflow-hidden flex items-center justify-center p-4">
        {/* Placeholder for screenshots of admin dashboard and booking form */}
        <span className="text-white text-6xl opacity-70">
          <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-laptop-2">
            <path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z" />
            <path d="M2 14h20" />
            <circle cx="12" cy="17" r="1" />
          </svg>
        </span>
        <div className="absolute bottom-4 right-4 text-white text-sm opacity-80">Software Interface Mockup</div>
      </div>
    </div>

    <div className="mt-12 text-center">
      <h3 className="text-3xl font-bold text-gray-800 mb-4">Experience Our Digital Platform</h3>
      <p className="text-lg text-gray-700 mb-6 max-w-3xl mx-auto">
        Our Progressive Web App (PWA) delivers a native app-like experience directly from your browser, ensuring speed, reliability, and offline capabilities.
      </p>
      <div className="bg-blue-50 p-6 rounded-xl shadow-inner inline-block">
        <span className="block text-blue-700 font-semibold text-xl mb-4">Watch a Demo (Placeholder)</span>
        <div className="w-full max-w-xl aspect-video bg-gray-200 rounded-lg flex items-center justify-center text-gray-500 text-sm italic overflow-hidden">
          {/* Placeholder for an embedded video or GIF demo */}
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-play-circle">
            <circle cx="12" cy="12" r="10" />
            <polygon points="10 8 16 12 10 16 10 8" />
          </svg>
          <span className="ml-2">Video Demo Coming Soon!</span>
        </div>
        <p className="mt-4 text-md text-blue-600 font-semibold">
          Seamlessly integrated for mobile and desktop users.
        </p>
      </div>
    </div>

    <div className="mt-12 text-center">
      <h3 className="text-3xl font-bold text-gray-800 mb-4">Partner With Us</h3>
      <p className="text-lg text-gray-700 mb-6 max-w-4xl mx-auto">
        Are you an exchange company looking to modernize your operations, improve efficiency, and enhance customer experience? Al-Dahmen invites you to partner with us and leverage our cutting-edge software solutions. Transform your business with technology built by experts in the exchange industry.
      </p>
      <button
        onClick={() => { /* Placeholder for a modal or direct contact form open */ }}
        className="bg-gradient-to-r from-teal-500 to-green-600 hover:from-teal-600 hover:to-green-700 text-white font-bold py-4 px-10 rounded-full shadow-xl transition-all duration-300 transform hover:scale-105 animate-bounce-slow"
      >
        <span className="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-handshake">
            <path d="m11 17 2 2-6 2v-2z" />
            <path d="m14 11 2 2-6 2v-2z" />
            <path d="m17 5 2 2-6 2v-2z" />
            <path d="M12 17a3 3 0 0 0 0 6c1.24 0 2.4-.48 3.28-1.37L22 17l-4-4c-.87-.87-2.03-1.37-3.28-1.37h-3a3 3 0 0 0-3 3v4a3 3 0 0 0 3 3h4c1.24 0 2.4-.48 3.28-1.37L17 22l4 4c.87.87 1.37 2.03 1.37 3.28v-4a3 3 0 0 0-3-3h-4a3 3 0 0 0-3 3Z" />
          </svg>
          Inquire About Partnership
        </span>
      </button>
    </div>
  </section>
);

const ContactPage = ({ db, userId, showCustomModal }) => {
  const [inquiryForm, setInquiryForm] = useState({
    name: '',
    email: '',
    subject: '',
    message: '',
  });
  const [loading, setLoading] = useState(false);

  const handleInquiryChange = (e) => {
    const { name, value } = e.target;
    setInquiryForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleInquirySubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    if (!db || !userId) {
      showCustomModal('Firebase not initialized or user not authenticated. Please try again.', true);
      setLoading(false);
      return;
    }

    if (!inquiryForm.name || !inquiryForm.email || !inquiryForm.subject || !inquiryForm.message) {
      showCustomModal('Please fill in all inquiry form fields.', true);
      setLoading(false);
      return;
    }

    try {
      const inquiryData = {
        ...inquiryForm,
        timestamp: serverTimestamp(),
        // Store in public collection /artifacts/{appId}/public/data/{your_collection_name}
        submittedByUserId: userId,
      };

      await addDoc(collection(db, `artifacts/${appId}/public/data/partnerInquiries`), inquiryData);
      showCustomModal('Your inquiry has been sent successfully! We will get back to you soon.', false);
      setInquiryForm({ name: '', email: '', subject: '', message: '' }); // Reset form
    } catch (error) {
      console.error("Error submitting inquiry:", error);
      showCustomModal(`Failed to send inquiry: ${error.message}`, true);
    } finally {
      setLoading(false);
    }
  };

  return (
    <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in-down px-4">
      <h2 className="text-4xl font-extrabold text-blue-700 mb-8 text-center border-b-4 border-blue-200 pb-4">Contact Us</h2>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
        {/* Contact Information */}
        <div className="bg-blue-50 p-6 rounded-xl shadow-inner flex flex-col justify-between">
          <div>
            <h3 className="text-3xl font-bold text-gray-800 mb-4">Get in Touch</h3>
            <p className="text-lg text-gray-700 mb-6">
              We're here to help! Reach out to us through any of the following channels.
            </p>

            <div className="space-y-4 mb-8">
              <div className="flex items-center text-gray-700 text-lg">
                <img src="https://placehold.co/24x24/008000/ffffff?text=W" alt="WhatsApp icon" className="mr-3" />
                <span>WhatsApp: <a href="https://wa.me/+9647XXXXXXXX" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">+964 7XX XXX XXXX</a></span>
              </div>
              <div className="flex items-center text-gray-700 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-phone mr-3 text-blue-600">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2 3.82a2 2 0 0 1 2-2.18h3a2 2 0 0 1 2 1.73l.41 1.64a2 2 0 0 1-.52 2.31l-1.9 1.9a15 15 0 0 0 6 6l1.9-1.9a2 2 0 0 1 2.31-.52l1.64.41a2 2 0 0 1 1.73 2Z" />
                </svg>
                <span>Phone: <a href="tel:+9647XXXXXXXX" className="text-blue-600 hover:underline">+964 7XX XXX XXXX</a></span>
              </div>
              <div className="flex items-center text-gray-700 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-mail mr-3 text-blue-600">
                  <rect width="20" height="16" x="2" y="4" rx="2" />
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
                </svg>
                <span>Email: <a href="mailto:info@aldahmenexchange.com" className="text-blue-600 hover:underline">info@aldahmenexchange.com</a></span>
              </div>
            </div>
          </div>

          <div>
            <h3 className="text-3xl font-bold text-gray-800 mb-4">Working Hours</h3>
            <div className="bg-white p-4 rounded-lg shadow-md flex items-center justify-center gap-4 text-blue-700 font-semibold">
              <Clock size={24} />
              <span>Saturday - Thursday: 9:00 AM - 5:00 PM</span>
            </div>
            <p className="text-md text-gray-600 mt-2 text-center">Friday: Closed</p>
          </div>
        </div>

        {/* Inquiry Form */}
        <div className="bg-purple-50 p-6 rounded-xl shadow-inner">
          <h3 className="text-3xl font-bold text-gray-800 mb-6">Send Us an Inquiry</h3>
          <form onSubmit={handleInquirySubmit} className="space-y-6">
            <div>
              <label htmlFor="inquiryName" className="block text-gray-700 text-sm font-bold mb-2">Your Name:</label>
              <input
                type="text"
                id="inquiryName"
                name="name"
                value={inquiryForm.name}
                onChange={handleInquiryChange}
                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
                required
              />
            </div>
            <div>
              <label htmlFor="inquiryEmail" className="block text-gray-700 text-sm font-bold mb-2">Your Email:</label>
              <input
                type="email"
                id="inquiryEmail"
                name="email"
                value={inquiryForm.email}
                onChange={handleInquiryChange}
                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
                required
              />
            </div>
            <div>
              <label htmlFor="inquirySubject" className="block text-gray-700 text-sm font-bold mb-2">Subject:</label>
              <input
                type="text"
                id="inquirySubject"
                name="subject"
                value={inquiryForm.subject}
                onChange={handleInquiryChange}
                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
                required
              />
            </div>
            <div>
              <label htmlFor="inquiryMessage" className="block text-gray-700 text-sm font-bold mb-2">Your Message:</label>
              <textarea
                id="inquiryMessage"
                name="message"
                value={inquiryForm.message}
                onChange={handleInquiryChange}
                rows="5"
                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200 resize-y"
                required
              ></textarea>
            </div>
            <div className="text-center">
              <button
                type="submit"
                disabled={loading}
                className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center mx-auto min-w-[150px]"
              >
                {loading ? (
                  <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                ) : (
                  <>
                    <Mail size={20} className="mr-2" /> Send Message
                  </>
                )}
              </button>
            </div>
          </form>
        </div>
      </div>

      <div className="mt-12 text-center">
        <h3 className="text-3xl font-bold text-gray-800 mb-4">Branch Address</h3>
        <p className="text-lg text-gray-700 mb-6">
          Find us easily on the map!
        </p>
        <div className="bg-gray-200 p-6 rounded-xl shadow-inner max-w-2xl mx-auto">
          <p className="text-xl font-semibold text-blue-700 mb-2">Al-Dahmen for Exchange</p>
          <p className="text-md text-gray-700 mb-4">
            [Specific Street Name], [Building/Block Number], Karbala Al-Muqaddasa, Iraq
          </p>
          <div className="w-full h-64 bg-gray-300 rounded-lg flex items-center justify-center text-gray-600 text-sm italic overflow-hidden">
            {/* Embedded Google Map - Replace with actual embed code */}
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d13778.653457002078!2d44.02077595!3d32.61715425!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMsrcMDgnNDQuMyJOIDQ0wrAxJzQyLjEiRQ!5e0!3m2!1sen!2siq!4v1678912345678!5m2!1sen!2siq"
              width="100%"
              height="100%"
              style={{ border: 0 }}
              allowFullScreen=""
              loading="lazy"
              referrerPolicy="no-referrer-when-downgrade"
              title="Al-Dahmen for Exchange Location"
              className="rounded-lg"
            ></iframe>
          </div>
        </div>
      </div>
    </section>
  );
};

const AdminLoginPage = ({ auth, db, userId, showCustomModal, setCurrentPage, userDisplayName }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);

    if (!auth) {
      showCustomModal('Firebase Auth not initialized. Please try again.', true);
      setLoading(false);
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, password);
      showCustomModal('Logged in successfully!', false);
      setCurrentPage('admin-dashboard'); // Redirect to admin dashboard
    } catch (error) {
      console.error("Admin login error:", error);
      showCustomModal(`Login failed: ${error.message}`, true);
    } finally {
      setLoading(false);
    }
  };

  if (auth?.currentUser?.email) {
    return (
      <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg text-center animate-fade-in px-4">
        <h2 className="text-3xl font-extrabold text-blue-700 mb-6">Welcome, {userDisplayName.split('@')[0]}!</h2>
        <p className="text-lg text-gray-700 mb-8">You are already logged in as an administrator. Please proceed to the dashboard.</p>
        <button
          onClick={() => setCurrentPage('admin-dashboard')}
          className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center mx-auto"
        >
          Go to Admin Dashboard
        </button>
      </section>
    );
  }

  return (
    <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in-right max-w-md px-4">
      <h2 className="text-4xl font-extrabold text-blue-700 mb-8 text-center border-b-4 border-blue-200 pb-4">Admin Login</h2>
      <p className="text-lg text-gray-700 mb-6 text-center">
        For internal staff access only.
      </p>
      <form onSubmit={handleLogin} className="space-y-6">
        <div>
          <label htmlFor="adminEmail" className="block text-gray-700 text-sm font-bold mb-2">Email:</label>
          <input
            type="email"
            id="adminEmail"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
            required
          />
        </div>
        <div>
          <label htmlFor="adminPassword" className="block text-gray-700 text-sm font-bold mb-2">Password:</label>
          <input
            type="password"
            id="adminPassword"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200"
            required
          />
        </div>
        <div className="text-center">
          <button
            type="submit"
            disabled={loading}
            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center mx-auto min-w-[150px]"
          >
            {loading ? (
              <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            ) : (
              <>
                <LogIn size={20} className="mr-2" /> Login
              </>
            )}
          </button>
        </div>
      </form>
      <p className="mt-8 text-center text-sm text-gray-500">
        <span className="font-semibold">Note for Demo:</span> Use any email and password for login. The authentication works as a placeholder. For a real system, you would set up specific admin accounts in Firebase Auth.
      </p>
    </section>
  );
};

const AdminDashboard = ({ db, userId, showCustomModal, userDisplayName }) => {
  const [bookings, setBookings] = useState([]);
  const [inquiries, setInquiries] = useState([]);
  const [loadingBookings, setLoadingBookings] = useState(true);
  const [loadingInquiries, setLoadingInquiries] = useState(true);
  const [activeTab, setActiveTab] = useState('bookings'); // 'bookings' or 'inquiries'

  // Fetch travel dollar bookings
  useEffect(() => {
    if (!db || !userId) return;

    setLoadingBookings(true);
    // Listen for real-time updates using onSnapshot
    const q = collection(db, `artifacts/${appId}/public/data/travelDollarBookings`);
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const fetchedBookings = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      // Sort bookings by timestamp descending (most recent first)
      fetchedBookings.sort((a, b) => b.timestamp?.toDate() - a.timestamp?.toDate());
      setBookings(fetchedBookings);
      setLoadingBookings(false);
    }, (error) => {
      console.error("Error fetching bookings:", error);
      showCustomModal(`Error loading bookings: ${error.message}`, true);
      setLoadingBookings(false);
    });

    // Cleanup subscription on unmount
    return () => unsubscribe();
  }, [db, userId, showCustomModal]);

  // Fetch partner inquiries
  useEffect(() => {
    if (!db || !userId) return;

    setLoadingInquiries(true);
    // Listen for real-time updates using onSnapshot
    const q = collection(db, `artifacts/${appId}/public/data/partnerInquiries`);
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const fetchedInquiries = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      // Sort inquiries by timestamp descending (most recent first)
      fetchedInquiries.sort((a, b) => b.timestamp?.toDate() - a.timestamp?.toDate());
      setInquiries(fetchedInquiries);
      setLoadingInquiries(false);
    }, (error) => {
      console.error("Error fetching inquiries:", error);
      showCustomModal(`Error loading inquiries: ${error.message}`, true);
      setLoadingInquiries(false);
    });

    // Cleanup subscription on unmount
    return () => unsubscribe();
  }, [db, userId, showCustomModal]);

  const updateBookingStatus = async (bookingId, newStatus) => {
    if (!db) {
      showCustomModal('Database not initialized.', true);
      return;
    }
    try {
      const bookingRef = doc(db, `artifacts/${appId}/public/data/travelDollarBookings`, bookingId);
      await updateDoc(bookingRef, { status: newStatus });
      showCustomModal(`Booking ${bookingId} status updated to ${newStatus}!`, false);
    } catch (error) {
      console.error("Error updating booking status:", error);
      showCustomModal(`Failed to update status: ${error.message}`, true);
    }
  };

  const deleteInquiry = async (inquiryId) => {
    if (!db) {
      showCustomModal('Database not initialized.', true);
      return;
    }
    try {
      const inquiryRef = doc(db, `artifacts/${appId}/public/data/partnerInquiries`, inquiryId);
      await deleteDoc(inquiryRef);
      showCustomModal(`Inquiry ${inquiryId} deleted successfully!`, false);
    } catch (error) {
      console.error("Error deleting inquiry:", error);
      showCustomModal(`Failed to delete inquiry: ${error.message}`, true);
    }
  };

  return (
    <section className="container mx-auto my-12 p-8 bg-white rounded-lg shadow-lg animate-fade-in px-4">
      <h2 className="text-4xl font-extrabold text-blue-700 mb-4 text-center border-b-4 border-blue-200 pb-4">Admin Dashboard</h2>
      <p className="text-xl text-gray-700 mb-8 text-center">Welcome, <span className="font-semibold text-blue-600">{userDisplayName.split('@')[0]}</span>! Your User ID: <span className="font-mono text-sm bg-gray-100 p-1 rounded">{userId}</span></p>

      {/* Tabs for navigation */}
      <div className="flex justify-center mb-8 border-b border-gray-200">
        <button
          onClick={() => setActiveTab('bookings')}
          className={`py-3 px-6 text-lg font-medium rounded-t-lg transition-colors duration-200 ${activeTab === 'bookings' ? 'bg-blue-600 text-white shadow-md' : 'text-gray-700 hover:bg-gray-100'}`}
        >
          Travel Dollar Bookings
        </button>
        <button
          onClick={() => setActiveTab('inquiries')}
          className={`py-3 px-6 text-lg font-medium rounded-t-lg transition-colors duration-200 ${activeTab === 'inquiries' ? 'bg-blue-600 text-white shadow-md' : 'text-gray-700 hover:bg-gray-100'}`}
        >
          Partner Inquiries
        </button>
      </div>

      {/* Bookings Tab Content */}
      {activeTab === 'bookings' && (
        <div>
          <h3 className="text-3xl font-bold text-gray-800 mb-6 text-center">Travel Dollar Booking Requests</h3>
          {loadingBookings ? (
            <div className="text-center py-8">
              <p className="text-gray-600">Loading bookings...</p>
            </div>
          ) : bookings.length === 0 ? (
            <div className="text-center py-8 bg-blue-50 rounded-lg shadow-inner">
              <p className="text-gray-600 text-lg">No travel dollar bookings found.</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              {bookings.map((booking) => (
                <div key={booking.id} className="bg-blue-50 p-6 rounded-lg shadow-md border-t-4 border-blue-400 flex flex-col justify-between">
                  <div>
                    <h4 className="text-xl font-bold text-blue-800 mb-2">{booking.name}</h4>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Email:</span> {booking.email}</p>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Phone:</span> {booking.phone}</p>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Passport:</span> {booking.passportNumber}</p>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Ticket:</span> {booking.ticketNumber}</p>
                    <p className="text-gray-700 text-sm mb-3"><span className="font-semibold">Amount:</span> ${booking.amount}</p>
                    <p className={`text-sm font-semibold mb-4 ${booking.status === 'Approved' ? 'text-green-600' : booking.status === 'Rejected' ? 'text-red-600' : 'text-yellow-600'}`}>
                      Status: {booking.status}
                    </p>
                    <p className="text-xs text-gray-500 mb-4">
                      Submitted: {booking.timestamp ? new Date(booking.timestamp.toDate()).toLocaleString() : 'N/A'}
                    </p>
                  </div>
                  <div className="flex flex-col gap-3 mt-auto">
                    <div className="flex justify-between gap-2">
                      {booking.passportFileUrl && (
                        <a href={booking.passportFileUrl} target="_blank" rel="noopener noreferrer" className="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-semibold py-2 px-4 rounded-lg text-center transition-colors duration-200 text-sm flex items-center justify-center gap-1">
                          <UploadCloud size={16} /> Passport
                        </a>
                      )}
                      {booking.ticketFileUrl && (
                        <a href={booking.ticketFileUrl} target="_blank" rel="noopener noreferrer" className="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-semibold py-2 px-4 rounded-lg text-center transition-colors duration-200 text-sm flex items-center justify-center gap-1">
                          <UploadCloud size={16} /> Ticket
                        </a>
                      )}
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => updateBookingStatus(booking.id, 'Approved')}
                        className="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 text-sm flex items-center justify-center gap-1"
                      >
                        <CheckCircle size={16} /> Approve
                      </button>
                      <button
                        onClick={() => updateBookingStatus(booking.id, 'Rejected')}
                        className="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 text-sm flex items-center justify-center gap-1"
                      >
                        <XCircle size={16} /> Reject
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      {/* Inquiries Tab Content */}
      {activeTab === 'inquiries' && (
        <div>
          <h3 className="text-3xl font-bold text-gray-800 mb-6 text-center">Partner Inquiry Messages</h3>
          {loadingInquiries ? (
            <div className="text-center py-8">
              <p className="text-gray-600">Loading inquiries...</p>
            </div>
          ) : inquiries.length === 0 ? (
            <div className="text-center py-8 bg-purple-50 rounded-lg shadow-inner">
              <p className="text-gray-600 text-lg">No partner inquiries found.</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              {inquiries.map((inquiry) => (
                <div key={inquiry.id} className="bg-purple-50 p-6 rounded-lg shadow-md border-t-4 border-purple-400 flex flex-col justify-between">
                  <div>
                    <h4 className="text-xl font-bold text-purple-800 mb-2">{inquiry.name}</h4>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Email:</span> {inquiry.email}</p>
                    <p className="text-gray-700 text-sm mb-1"><span className="font-semibold">Subject:</span> {inquiry.subject}</p>
                    <p className="text-gray-700 text-sm mb-3 overflow-hidden text-ellipsis line-clamp-3">{inquiry.message}</p>
                    <p className="text-xs text-gray-500 mb-4">
                      Submitted: {inquiry.timestamp ? new Date(inquiry.timestamp.toDate()).toLocaleString() : 'N/A'}
                    </p>
                  </div>
                  <div className="mt-auto">
                    <button
                      onClick={() => deleteInquiry(inquiry.id)}
                      className="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 text-sm flex items-center justify-center gap-1"
                    >
                      <XCircle size={16} /> Delete Inquiry
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}
    </section>
  );
};

export default App;
